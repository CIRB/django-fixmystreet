{% extends "base.html" %}
{% load i18n %}
{% load tags %}
{% block title %}{% trans "Reports for" %} {{ward.name}}, {{ward.city.name}}{% endblock %}
{% block css %}
<style>
#map-bxl{
	height: 520px;
	width: 520px;
}
</style>
{% endblock %}

{% block script %}
{% map_scripts %}
<script>
$(function(){

	
	$('#map-bxl').fmsMap();
	$.ajax({
		url:'/api/wards/',
		type:'GET',
		dataType:'json',
		success:function(response)
		{
			$('#map-bxl').fmsMap('highlightArea',response.features[{{ ward.number }}].geometry);
		},
		error:function()
		{
			$form.prepend('<p class="error-msg">Unexpected error.</p>');
		}
	});
	{% for report in reports %}
	$('#map-bxl').fmsMap('addReport',  {% report_to_json report %});
	{% endfor %}
	
	$('#map-bxl').bind('reportselected',function(evt, point, report){
		window.location.assign('/reports/' + report.id);
	});

});

</script>
{% endblock %}
{% block content %}
	<div id="fullwidth">
		<div id='leftcol'>
			<h1>{% trans "Reports for" %} {{ward.name}}</h1>
			<p>{% for zip in ward.zipcode_set.all %}{{zip.code}}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
			<p>{% blocktrans with start=date_range_start|date:"j N Y" end=date_range_end|date:"j N Y" %}Reports filed between {{ start }} and {{ end }}.{% endblocktrans %} 
			{% if older_reports_link %} (<a href="{{older_reports_link}}" %}>{% trans "See older reports" %}</a>){% endif %}</p>

			{% if not reports %}
			<p>{% trans "No problems have been reported." %}</p>
			{% endif %}
			<ol>
				<!-- values of status can be: {% trans "New Problems" %}, {% trans "Older Unresolved Problems" %}, {% trans "Recently Fixed" %}, {% trans "Old Fixed" %}-->
				{% for report in reports %}					
					{% ifchanged report.status %}  	
					<h2>{% trans report.status %}</h2>
					{% endifchanged %}
                    <li><a href='{{report.get_absolute_url}}'>{{report.title}}</a></li>
                {% endfor %}
             </ol>
             <br/><br/>
             {% if reports %}
             <div class="fix-disclaimer">
             	<p>{% trans "Note: Fix My Street relies on users to report problems as fixed." %}</p>
             </div>
             {% endif %}
 		</div>
		<div id='rightcol'>
			<div id="map-bxl"> </div>
    		{% include "wards/_info_box.html" %}
		</div>
	</div>
	<br/ style="clear:both;">
{% endblock %}
