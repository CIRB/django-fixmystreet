{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "Reports for" %} {{ward.name}}, {{ward.city.name}}{% endblock %}
{% block css %}
<style>
#map-bxl{
	height: 520px;
	width: 520px;
}
</style>
{% endblock %}
{% block script %}
<!--<script type="text/javascript" src="/media/wards.json"></script>-->
<script src="http://openlayers.org/api/2.11/OpenLayers.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
<script src="/media/js/fixmystreetmap.js"></script>
<script>
$(function(){

	
	$('#map-bxl').fmsMap();
	$.ajax({
		url:'/api/wards/',
		type:'GET',
		dataType:'json',
		success:function(response)
		{
			$('#map-bxl').fmsMap('highlightArea',response.features[{{ ward.number }}].geometry);
		},
		error:function()
		{
			$form.prepend('<p class="error-msg">Unexpected error.</p>');
		}
	});
	{% for report in reports %}
	$('#map-bxl').fmsMap('addMarker', {{ report.point.x }}, {{ report.point.y }}, {% if report.is_fixed %}true{% else %}false{% endif %});
	{% endfor %}
});

</script>
{% endblock %}
{% block content %}
	<div id="fullwidth">
	<h3>{% trans "Reports for" %} {{ward.name}}, {{ward.city.name}} (Ward {{ward.number}})</h3>
	<p>{% trans "Reports filed between" %} {{date_range_start|date:"N jS, Y"}} {% trans "and" %} {{date_range_end|date:"N jS, Y"}}. 
		{% if older_reports_link %} (<a href="{{older_reports_link}}" %}>{% trans "See older reports" %}</a>){% endif %}</p>
		<div id='leftcol'>
			{% if not reports %}
			<p>{% trans "No problems have been reported." %}</p>
			{% endif %}
			<ol>
				{% for report in reports %}					
					{% ifchanged report.status %}  	
					<h2>{% trans report.status %}</h2>
					{% endifchanged %}
                    <li><a href='{{report.get_absolute_url}}'>{{report.title}}</a></li>
                {% endfor %}
             </ol>
             <br/><br/>
             {% if reports %}
             <div class="fix-disclaimer">
             	<p>{% trans "Note: fixmystreet.ca relies on users to report problems as fixed." %}</p>
             </div>
             {% endif %}
 		</div>
		<div id='rightcol'>
			<div id="map-bxl"> </div>
    		{% include "wards/_info_box.html" %}
		</div>
	</div>
	<br/ style="clear:both;">
{% endblock %}
