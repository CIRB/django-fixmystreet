{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "New Report" %}{% endblock %}
{% block script %}
{% include '_fixmystreetmap.js' %}
<script>
 $(document).ready(function() {
	$('#id_category').change(function(evt) {
		// updates entry notes
		var el_id = $('#id_category').val();
		if(el_id)
		{
			$("#secondary_container").load("/ajax/categories/"+el_id);
		}
		else
		{
			$("#secondary_container").html('');
		}
	});
	$('#id_category').change();// initialize notes
	
	$('#map-bxl').bind('markermoved',function(evt,point){
		$('#id_lon').val(point.x);
		$('#id_lat').val(point.y);
	});
	
	//Wath is it for ????
	if($('input[name=is_hate]:checked').val() == 'yes') {
		$('.ishate').show();
	}


	$('.radiohate').live('click', function(event) {
		if($(this)[0].value =='yes') {
			$('.ishate').show('slow');
			// disable fields
			$('.hideonhate').hide();
			$('#submit_report_button').enabled = false;
	
		} else {
			$('.ishate').hide();
			$('.hideonhate').show();
			$('#submit_report_button').enabled = true;
		}
	});
	
	openMap({{ pnt.x }}, {{ pnt.y }});
	addDraggableMarker({{ pnt.x }}, {{ pnt.y }});
	{% for report in reports %}
	addMarker({{ report.point.x }}, {{ report.point.y }}, {% if report.is_fixed %}true{% else %}false{% endif %});
	{% endfor %}
});
</script>
{% endblock %}
{% block content %}

<style>
#leftcol ul {
list-style-type:disc !important;
margin-left:1.5em;
}
/*.ishate {display:none;}*/
</style>
<div id="page_content_container">
	<div id="leftcol">
		<h3>{% trans "Submitting a report" %}</h3>
	
		<form enctype="multipart/form-data" method="post" action="/reports/" id='report_form'>
			<table class='form'>
				{{ report_form.as_table }}
				<tr>
					<th></th>
					<td id="photo_note">{% trans "* Optional" %}</td>
				</tr>
				<tr>
					<td></td>
					<td><div id='secondary_container'></div></td>
				</tr>
				{{ update_form.as_table }}
				<tr>
					<td></td>
					<td>
						<div class='note'>
							<p><strong>{% trans "Please Note" %} :</strong></p>
							<ul>
								<li>{% trans "Please be polite, concise and to the point." %}</li>
								<li>{% trans "Please do not be abusive - abusing the service devalues the service for all users." %}</li>
								<li>{% trans "Writing your message entirely in block capitals makes it hard to read, as does a lack of punctuation." %}</li>
								<li>{% trans "Remember that FixMyStreet is primarily for reporting physical problems that can be fixed. If your problem is not appropriate for submission via this site please contact city officials directly." %}</li>
							</ul>
							<p/>
						</div>
					</td>
				</tr>
				<tr>
					<td></td>
					<td align="right"><input type="submit" class='big_button' value="{% trans "Submit" %}" /></td>
				</tr>
			</table>
		</form>
	</div>
	<div id="rightcol">
		<div id="map-bxl" style="width:520px;height:400px;"></div>
		<div id='report-destination'>
			<b>{% trans "Where will my report be sent?" %}</b>
			<ul>
				{% for rule in ward.get_rule_descriptions %}
				<li>{{rule}}</li>
				{% endfor %}
			</ul>
			<p>
				<strong>
					{% trans "Nearby reports filed between" %} 
					{{date_range_start|date:"N jS, Y"}} {% trans "and" %} {{date_range_end|date:"N jS, Y"}}
					{% if older_reports_link %} (<a href="{{older_reports_link}}" %}>{% trans "See older reports" %}</a>){% endif %}:
				</strong>
			</p>
			
			{% if reports %}
				<ol id='search_results'>
				{% for report in reports %}
					<li><a href="{{report.get_absolute_url}}"> {{report.title}} ({{report.distance.km|floatformat:2}} km)</a>
					{% if report.is_fixed %}({% trans "fixed" %}){% endif %}
					</li>
				{% endfor %}
				</ol>
				<p>{% trans "Zoom out to see more reports nearby." %}</p>
			{% else %}
				<p>{% trans "No problems have been reported in this area." %}</p>
			{% endif %}
			</ol>
		</div>
	</div>
</div>
{% endblock %}