<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/global.css" />
		<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/layout.css" />
		<link rel="Shortcut Icon" type="image/x-icon" href="{{ MEDIA_URL }}images/favicon.ico" />
		{% load i18n %}
		{% get_available_languages as LANGUAGES %}
	
		<title>{% trans "Fix My Street Brussels" %} - {% block title %}{% trans "Home" %}{% endblock %}</title>
		{% block css %}{% endblock %}
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.js"></script>
		{% block script %}{% endblock %}
		<script>
        var loginWin = null;
		$(document).ready(function(){
			$('#select-language').change(function(){
				$(this).closest('form').submit();
			});
            $('.login-btn').click(function(evt){
                evt.preventDefault();
                var loginHref = $(this).prop('href');
                var title = $(this).prop('class').replace(' ', '_');
                if(loginWin == null || loginWin.closed) {
                    loginWin = window.open(loginHref,title, "menubar=no,location=no,resizable=no,scrollbars=no,status=no,width=780,height=410");
                } else {
                    loginWin.focus();
                }
                if(loginWin == null) {
                    // popup has been blocked...
                    window.location.assign(loginHref);
                }
                return false;
            });
		});
        window.connectionCallback = function(username){
            $(document).trigger('connected',[username]);
            $('.login-bar').hide();
            $('.logged-bar').show().find('.username').html(username);
        }
        
        /*
        .required.mandatory input, .required.mandatory select {
            border:1px solid red !important;
        }
        form.required-invalid .required-msg {
            color:red;
        }
        
        $(document).delegate("form", "submit", function(evt) {
            var $form = $(this);
            var valid = true;
            
            $('.required input, .required select').each(function(ind,input) {
                var $input = $(input);
                if(!$input.val()) {
                    valid = false;
                    $input.closest('.required').addClass('mandatory');
                } else {
                    $input.closest('.required').removeClass('mandatory');
                }
            });
            
            if(!valid) {
                evt.preventDefault();

                $form.find('.mandatory input, .mandatory select').first().focus();
                $form.find('.required-error-msg').fadeIn();
                $form.addClass('required-invalid');
                
                return false;
            }
        });
        */
		</script>
	</head>

	<body>
		<div id="header">
			<div id="header_content">
				<a href="/"><img id="logo" src="{{ MEDIA_URL }}images/logo-{{ LANGUAGE_CODE }}.jpg" alt="{% trans "Fix My Street Brussels" %}"/></a>
				<!--<a href="/"><h1 id="banner-title">{% trans "Fix My Street Brussels" %}</h1></a>-->
                <img id="logo-rbc" src="{{ MEDIA_URL }}images/logo-rbc-{{ LANGUAGE_CODE }}.jpg" alt="{% trans "Brussels-Capital Region" %}"/>
				<div id="language">
					<form action="/i18n/setlang/" method="post">
						<select id="select-language" name="language">
							{% for l in LANGUAGES %}
                                {% get_language_info for l.0 as lang %}
                                <option value="{{ lang.code }}"{% if lang.code == LANGUAGE_CODE %} selected="selected"{% endif %}>{{ lang.name_local }}</option>
							{% endfor %}
						</select>
					</form>
				</div>
				{% load tags %}
				<div id="menu">
					{% get_active_menu %}
					<a class="{% ifequal 'submit' menu %}active{% endifequal %}"   href="{% url home %}">{%      trans "Submit a Report" %}</a>
					<a class="{% ifequal 'view' menu %}active{% endifequal %}"     href="{% url bxl_wards %}">{% trans "View Reports" %}</a>
					<a class="{% ifequal 'about' menu %}active{% endifequal %}"    href="{% url about %}">{%     trans "About" %}</a>
					<a class="{% ifequal 'contact' menu %}active{% endifequal %}"  href="{% url contact %}">{%   trans "Contact Us" %}</a>
				</div>
			</div>
		</div>

		<div id="main_container">
			<div id='body_content'>
                <p class="logged-bar"{% if not user.is_authenticated %} style="display:none;"{% endif %}>{% trans "Welcome" %} <span class="username">{{ user.get_full_name }}</span>. (<a href="{% url auth_logout  %}">logout</a>)</p>
                
                <p class="login-bar"{% if user.is_authenticated %} style="display:none;"{% endif %}>
                    <a class="fb-login login-btn" href="{% url socialauth_begin 'facebook' %}" title="{% trans 'Login with Facebook' %}"><span>Login</span></a>
                    <a class="gg-login login-btn" href="{% url socialauth_begin 'google-profile' %}" title="{% trans 'Login with Google' %}"><span>Login</span></a>
                </p>
                {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                    <p{% if message.tags %} class="msg {{ message.tags }}"{% endif %}>{{ message }}</p>
                    {% endfor %}
                </div>
                {% endif %}
				{% block content %}{% endblock %}
			</div>
		</div>

		<div id="footer">
			<div id="footer_content">
				{% block content_third %}{% endblock %}
                <p id="legal_notice">
                    <a id="term_of_use" href="{% url terms_of_use %}">{% trans "Terms of Use" %}</a>
                    Copyright 2011, <a href="http://www.cirb.irisnet.be">CIRB</a> <a href="http://www.cirb.irisnet.be"><img src="/media/images/CIRB-CIBG-inverse.gif"/></a>
                </p>
			</div>
		</div>

		{% block endbody %}{% endblock %}
	</body>
</html>
