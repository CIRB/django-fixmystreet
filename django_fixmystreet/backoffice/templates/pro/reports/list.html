{% extends "pro/base.html" %}
{% load i18n tags %}
{% block title %}{% blocktrans %}{{status}} Reports{%endblocktrans%}{% endblock %}
{% block script %}
{{ block.super }}
<script src="{{ STATIC_URL }}hashchange/jquery.ba-hashchange.min.js"></script>
{% map_scripts %}
<script>

$(document).ready(function() {

	var $form = $('#report_form');
	var $map = $('#map-bxl');

	$map.fmsMap({
		apiLang:'{{ LANGUAGE_CODE }}',
        localizeUrl: 'http://{{ SERVICE_GIS }}/urbis/Rest/Localize/getaddressfromxy',
        urbisUrl: 'http://{{ GEOSERVER }}/geoserver/wms',
        origin:{
			x:{{ pnt.x }},
			y:{{ pnt.y }} 
		}
	});
	{% for report in reports %}
	$map.fmsMap('addReport', {% report_to_json report %},{{forloop.counter}});
	{% endfor %}
	$map.fmsMap('addIndicator',{'x':{{ pnt.x }}, 'y':{{ pnt.y }}});

	$map.bind('reportselected',function(evt, point, report){
		//TODO get current url
		window.location.assign(report.id);
	});
	
	/*Hide the edition form*/
	$('#report_form').hide();
	$('#nearby-reports').show();
});
</script>
{% endblock %}

{% block content %}
<div id="page_content_container">
    <h1>{% blocktrans %}{{status}} Reports{%endblocktrans%}</h1>
	<div id="leftcol">
		<div id="nearby-reports">
            <h2>
                {% trans "Nearby reports" %} 
            </h2>
            {% if reports %}
                <div id='search_results'>
                {% for report in reports %}
                {% include "reports/_navigation.html" with url=report.get_absolute_url_pro %}
                {% endfor %}
                </div>
            {% else %}
                <p>{% trans "No problems have been reported in this area." %}</p>
            {% endif %}
		</div>
	
		<form enctype="multipart/form-data" method="post" action="" id='report_form' style="display:none;">
            <h2>
                {% trans "Fill the report" %} 
            </h2>
			<table class='form'>
				<tr>
					<th></th>
					<td id="required_note">{% trans "* This fields are required" %}</td>
				</tr>
				{{ report_form.as_table }}
				<tr>
					<td></td>
					<td><div id='secondary_container'></div></td>
				</tr>
				<tr>
					<td></td>
					<td align="right">
                        <p>
                            <input type="submit" class='big_button' value="{% trans 'Submit' %}" />
                        </p>
                        
                    </td>
				</tr>
			</table>
		</form>
	</div>
	<div id="rightcol">
		<div id="map-bxl">
			
		</div>
		<h3>{% trans "Zoom out to see more reports nearby." %}</h3>
        <div class='note'>
            <p><strong>{% trans "Please Note" %} :</strong></p>
            <ul>
                <li>{% trans "Please be polite, concise and to the point." %}</li>
                <li>{% trans "Please do not be abusive - abusing the service devalues the service for all users." %}</li>
                <li>{% trans "Writing your message entirely in block capitals makes it hard to read, as does a lack of punctuation." %}</li>
                <li>{% trans "Remember that FixMyStreet is primarily for reporting physical problems that can be fixed. If your problem is not appropriate for submission via this site please contact city officials directly." %}</li>
            </ul>
            <p/>
        </div>
	</div>
</div>
{% endblock %}
