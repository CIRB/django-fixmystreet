{% extends "pro/reports/search.html" %}
{% load i18n tags %}

{% block map %}
{% endblock %}
{% block script_map %}
{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{ STATIC_URL }}lib/dataTables/css/jquery.dataTables.css"></link>
{{ block.super }}
{% endblock %}

{% block script %}
{{ block.super }}
<script src="{{ STATIC_URL }}lib/dataTables/js/jquery.dataTables.js"></script>
<script src="{{ STATIC_URL }}lib/dataTables-columnFilter/js/jquery.dataTables.columnFilter.js"></script>
<script>

jQuery.extend( jQuery.fn.dataTableExt.oSort, {
    "num-html-pre": function ( a ) {
        var x = String(a).replace( /<[\s\S]*?>/g, "" );
        return parseFloat( x );
    },

    "num-html-asc": function ( a, b ) {
        return ((a < b) ? -1 : ((a > b) ? 1 : 0));
    },

    "num-html-desc": function ( a, b ) {
        return ((a < b) ? 1 : ((a > b) ? -1 : 0));
    }
} );

$(document).ready(function() {
    var table = $('#result-table').dataTable({
            "aoColumns": [
                null,
                {
                    sType: "num-html"
                },
                null,
                null,
                null,
                null,
                null,
                null
            ]
        });
    // {
    //     "bStateSave": true
    // });
    table.columnFilter({ sPlaceHolder: "head:after",
        aoColumns: [
            null,
            {type: "number"}, // incidnet number
            {type: "select"}, // categories
            {type: "select"}, // sec cat
            {type: "text"}, // addr
            {type: "select", values: [ // status
                {% for s in reports.0|model_field_choices:'status' %}
                    "{{ s }}"{% if not forloop.last %},{% endif %}
                {% endfor %}
            ]},
            {type: "select"}, // resp entity
            {type: "select"} // resp manager
        ]
    });
    $('#column-visibility :checkbox').change(function () {
        var checked = $(this).prop('checked'),
            index = $(this).closest('li').index();
        table.fnSetColumnVis(index, checked);
    }).change();
});

</script>
{% endblock %}

{% block results %}
<p class="span12"><a class="btn" href="{% url 'report_list_pro' %}">{% trans "Display as list" %}</a></p>
<div class="span12">
    <ul id="column-visibility">
        <li><label><input type="checkbox" checked />{% trans "Ticket" %}</label></li>
        <li><label><input type="checkbox" checked />{% trans "Category" %}</label></li>
        <li><label><input type="checkbox" checked />{% trans "Sub category" %}</label></li>
        <li><label><input type="checkbox" checked />{% trans "Address" %}</label></li>
        <li><label><input type="checkbox" checked />{% trans "Status" %}</label></li>
        <li><label><input type="checkbox" checked />{% trans "Responsible" %}</label></li>
        <li><label><input type="checkbox" checked />{% trans "Manager" %}</label></li>
    </ul>
    <table id="result-table" class="dataTable">
        <thead>
            <tr>
                <th>{% trans "Ticket" %}</th>
                <th>{% trans "Category" %}</th>
                <th>{% trans "Sub category" %}</th>
                <th>{% trans "Address" %}</th>
                <th>{% trans "Status" %}</th>
                <th>{% trans "Responsible" %}</th>
                <th>{% trans "Manager" %}</th>
            </tr>
            <tr>
                <th>{% trans "Ticket" %}</th>
                <th>{% trans "Category" %}</th>
                <th>{% trans "Sub category" %}</th>
                <th>{% trans "Address" %}</th>
                <th>{% trans "Status" %}</th>
                <th>{% trans "Responsible" %}</th>
                <th>{% trans "Manager" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for report in reports %}
            <tr>
                <td><a href="{{ report.get_absolute_url_pro }}">{% trans "Show" %}</a></td>
                <td>{{ report.id }}</td>
                <td>{{ report.category.name }}</td>
                <td>{{ report.secondary_category.name }}</td>
                <td>{{ report.address }}</td>
                <td>{{ report.get_status_display }}</td>
                <td>{{ report.responsible_entity.name }}</td>
                <td>{{ report.responsible_manager.get_full_name }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
