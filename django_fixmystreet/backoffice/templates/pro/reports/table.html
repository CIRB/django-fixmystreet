{% extends "base.html" %}
{% load i18n tags %}

{% block map %}
{% endblock %}
{% block script_map %}
{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{ STATIC_URL }}lib/dataTables/css/jquery.dataTables.css"></link>
<link rel="stylesheet" href="{{ STATIC_URL }}css/table.css"></link>
{{ block.super }}
{% endblock %}

{% block script %}
{{ block.super }}
<script src="{{ STATIC_URL }}lib/dataTables/js/jquery.dataTables.js"></script>
<script src="{{ STATIC_URL }}lib/dataTables-columnFilter/js/jquery.dataTables.columnFilter.js"></script>
<script>

$(document).ready(function() {
    jQuery.extend( jQuery.fn.dataTableExt.oSort, {
        "date-euro-pre": function ( a ) {
            if ($.trim(a) != '') {
                var datea = $.trim(a).split('/');
                var x = parseInt(datea[2] + datea[1] + datea[0]);
            } else {
                var x = 0;
            }

            return x;
        },

        "date-euro-asc": function ( a, b ) {
            return a - b;
        },

        "date-euro-desc": function ( a, b ) {
            return b - a;
        }
    });
    var columns = [
            {type: "null", bSortable: false},
            {type: "number"}, // incidnet number
            {type: "select"}, // categories
            {type: "select"}, // sec categories
            {type: "text"}, // addr
            {type: "select"}, // postal code
            {type: "select", values: [
                '{{ True|yesno:_("yes,no") }}',
                '{{ False|yesno:_("yes,no") }}'
            ]}, // regionnal
            {type: "select", values: [ // status
                {% for s in 'Report'|model_field_choices:'status' %}
                    "{{ s }}"{% if not forloop.last %},{% endif %}
                {% endfor %}
            ]},
            {type: "select"}, // resp entity
            {type: "select"}, // resp manager
            {type: "select", values: [
                '{{ True|yesno:_("yes,no") }}',
                '{{ False|yesno:_("yes,no") }}'
            ]}, // planned
            {sType: "date-euro", oSort:"date-eu"}, // date planned
            {type: "number"}, // priority
            {type: "select", values: [
                '{{ True|yesno:_("yes,no") }}',
                '{{ False|yesno:_("yes,no") }}'
            ]}, // subscribed
            {type: "select", values: [
                '{{ True|yesno:_("yes,no") }}',
                '{{ False|yesno:_("yes,no") }}'
            ]}, // pending
        ]
    var table = $('#result-table').dataTable({aoColumns: columns});
    // {
    //     "bStateSave": true
    // });
    table.columnFilter({ sPlaceHolder: "head:after", aoColumns: columns});

    $('#column-visibility :checkbox').change(function () {
        var checked = $(this).prop('checked'),
            index = $(this).closest('li').index() + 1; // show column
        table.fnSetColumnVis(index, checked);
    }).change();

    var showHideFilters = document.getElementById('showHideFilters');
    var tableFilters = document.getElementById('table-filters');

    showHideFilters.addEventListener('click', function() {
        tableFilters.classList.toggle('table-filters-show');
    });
});

</script>
{% endblock %}

{% block content %}
<div class="span12">


    <a href="#modalTable" role="button" class="btn" data-toggle="modal">ShowTable</a>
</div>

<div id="modalTable" class="modal hide fade" style="width: 90%; left: 20%;">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Table</h3>
    </div>

    <div class="modal-body">

        <button id="showHideFilters">Show/hide filters</button>
        <div id="table-filters" class="table-filters">
            <ul id="column-visibility">
                <li><label><input type="checkbox" checked /> {% trans "Ticket" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Category" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Sub category" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Address" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Postal code" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Regionnal" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Status" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Responsible" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Responsible department" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Planned" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Date planned" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Priority" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Subscribed" %}</label></li>
                <li><label><input type="checkbox" checked /> {% trans "Pending" %}</label></li>
            </ul>
        </div>

        <table id="result-table" class="dataTable">
            <thead>
                <tr>
                    <th></th>
                    <th>{% trans "Ticket" %}</th>
                    <th>{% trans "Category" %}</th>
                    <th>{% trans "Sub category" %}</th>
                    <th>{% trans "Address" %}</th>
                    <th>{% trans "Postal code" %}</th>
                    <th>{% trans "Regionnal" %}</th>
                    <th>{% trans "Status" %}</th>
                    <th>{% trans "Responsible" %}</th>
                    <th>{% trans "Responsible department" %}</th>
                    <th>{% trans "Planned" %}</th>
                    <th>{% trans "Date planned" %}</th>
                    <th>{% trans "Priority" %}</th>
                    <th>{% trans "Subscribed" %}</th>
                    <th>{% trans "Pending" %}</th>
                </tr>
                <tr>
                    <th></th>
                    <th>{% trans "Ticket" %}</th>
                    <th>{% trans "Category" %}</th>
                    <th>{% trans "Sub category" %}</th>
                    <th>{% trans "Address" %}</th>
                    <th>{% trans "Postal code" %}</th>
                    <th>{% trans "Regionnal" %}</th>
                    <th>{% trans "Status" %}</th>
                    <th>{% trans "Responsible" %}</th>
                    <th>{% trans "Responsible department" %}</th>
                    <th>{% trans "Planned" %}</th>
                    <th>{% trans "Date planned" %}</th>
                    <th>{% trans "Priority" %}</th>
                    <th>{% trans "Subscribed" %}</th>
                    <th>{% trans "Pending" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <td><a href="{{ report.get_absolute_url_pro }}">{% trans "Show" %}</a></td>
                    <td>{{ report.id }}</td>
                    <td>{{ report.category.name }}</td>
                    <td>{{ report.secondary_category.name }}</td>
                    <td>{{ report.address }}, {{report.address_number}}</td>
                    <td>{{ report.postalcode }} {{ zipcodes|get_element_from_list:report.postalcode }}</td>
                    <td>{{ report.address_regional|yesno:_("yes,no") }}</td>
                    <td>{{ report.get_status_display }}</td>
                    <td>{{ report.responsible_entity.name }}</td>
                    <td>{{ report.responsible_department.name }}</td>
                    <td>{{ report.planned|yesno:_("yes,no") }}</td>
                    <td>{{ report.date_planned|date:"d/m/Y" }}</td>
                    <td>{{ report.get_priority }}</td>
                    <td>{{ report.subscribed|yesno:_("yes,no") }}</td>
                    <td>{{ report.pending|yesno:_("yes,no") }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="modal-footer">
        <input type="button" class="btn"  value="{% trans 'Close'%}" data-dismiss="modal" aria-hidden="true"/>
    </div>
</div>
{% endblock %}
