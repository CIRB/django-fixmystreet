{% load i18n %}

<base href="{% if request.is_secure %}https{% else %}http{% endif %}://{{request.get_host}}" target="_blank"/>

<!-- ############################################################## -->
<!-- #######################JAVASCRIPT IMPORTS #################### -->
<!-- ############################################################## -->
<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}OpenLayers-2.11/OpenLayers.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/proj4js/engine/proj4js-compressed.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/proj4js/defs/EPSG31370.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/fixmystreetmap.js"></script>

<!-- ############################################################## -->
<!-- #######################JQUERY INIT METHOD #################### -->
<!-- ############################################################## -->
<script>
$(document).ready(function() {
	var $map = $('#map-bxl');
	$map.fmsMap({
		apiLang:'nl',
        	localizeUrl: 'http://service.gis.irisnet.be/urbis/Rest/Localize/getaddressfromxy',
        	urbisUrl: 'http://geoserver.gis.irisnet.be/geoserver/wms',
        	origin:{
				x:{{report.point.x}},
				y:{{report.point.y}}
			}
		});
});
</script>


<!-- ############################################################## -->
<!-- ####################### REPORT ############################### -->
<!-- ############################################################## -->
<hr/>
<h1>{% trans 'Report Data' %}</h1>
<div id="map-bxl" style="width:100%; height:200px">
			
</div>
<table style="width:100%">
	<tr>
		<td>
			<strong>
				{% trans 'Report Address' %}
			</strong>
		</td>	
		<td>
			<strong>
				{% trans 'Report City' %}
			</strong>
		</td>
                <td>
			&nbsp;
		</td>	
	</tr>
	<tr>
		<td>
			{{report.address}}, {{report.address_number}}
		</td>	
		<td>
			{{report.postalcode}} {{report.responsible_entity.name}}
		</td>	
                <td>
			&nbsp;
		</td>	
	</tr>
	<tr>
		<td>
			<strong>
				{% trans 'Report Category' %}
			</strong>
		</td>	
		<td>
			<strong>
				{% trans 'Report Responsible Manager' %}
			</strong>
		</td>
                <td>
			&nbsp;
		</td>	
	</tr>
	<tr>
		<td>
			{{report.display_category}}
		</td>	
		<td>
			{{report.responsible_manager.first_name}} {{report.responsible_manager.last_name}} (<a href="mailto:{{report.responsible_manager.email}}">{{report.responsible_manager.email}}</a>, {{report.responsible_manager.telephone}})
		</td>
                <td>
			&nbsp;
		</td>	
	</tr>
	<tr>
		<td>
			<strong>
				{% trans 'Report Ticket' %}
			</strong>
		</td>	
		<td>
			<strong>
				{% trans 'Report Geolocation' %}
			</strong>
		</td>	
                <td>
			&nbsp;
		</td>	
	</tr>
	<tr>
		<td>
			{{report.get_ticket_as_string}}	
		</td>	
		<td>
			L:{{report.point.x}} l:{{report.point.y}}
		</td>	
                <td>
			&nbsp;
		</td>	
	</tr>
	<tr>
		<td>
			<strong>
				{% trans 'Report Creation Date' %}
			</strong>
		</td>
		<td>
			<strong>
				{% if report.created_by or user.can_see_confidential %}
					{% trans 'Report Author' %}
				{% endif %}
			</strong>
		</td>	
		<td>
			<strong>
				{% if report.created_by or user.can_see_confidential %}
					{% trans 'Report Contact Phone' %}
				{% endif %}
			</strong>
		</td>	
	</tr>
	<tr>
		<td>
			{{report.created}}
		</td>	
		<td>
			{% if report.created_by %}
			{{report.created_by.fmsuser.get_display_name}}
			{% else %}
				{% if user.can_see_confidential %}
				{{report.citizen.fmsuser.get_display_name}}
				{% endif %}
			{% endif %}
		</td>
		<td>
			{% if report.created_by %}
			{{report.created_by.fmsuser.telephone}}
			{% else %}
				{% if user.can_see_confidential %}
				{{report.citizen.fmsuser.telephone}}
				{% endif %}
			{% endif %}
		</td>	
	</tr>
	<tr>
		<td>
			<strong>
				{% trans 'Report Status' %}
			</strong>
		</td>
		<td>
			<strong>
				{% if report.created_by or user.can_see_confidential %}
					{% trans 'Report Contact Mail' %}
				{% endif %}
			</strong>
		</td>	
                <td>
			&nbsp;
		</td>	
	</tr>
	<tr>
		<td>
			{{ report.get_status_display }}
		</td>	
		<td>
			{% if report.created_by %}
			<a href="mailto:{{report.created_by.fmsuser.email}}">{{report.created_by.fmsuser.email}}</a>
			{% else %}
			<!-- Protect citizen privacy -->
				{% if user.can_see_confidential %}
				<a href="mailto:{{report.citizen.fmsuser.email}}">{{report.citizen.fmsuser.email}}</a>
				{% endif %}
			{% endif %}
		</td>	
                <td>
			&nbsp;
		</td>	
	</tr>
</table>


<!-- ############################################################## -->
<!-- ####################### HISTORY ############################## -->
<!-- ############################################################## -->
<h1>{% trans 'Report History' %}</h1>
{% if activity_list %}
<table>
	{% for activity in activity_list %}
	<tr>
		<td>
			<li><strong>{{activity.event_at}}:</strong> {{activity}}</li>
		</td>
	</tr>
	{% endfor %}
</table>

{% else %}

<h3>{% trans 'No Report History' %}</h3>

{% endif %}

<!-- ############################################################## -->
<!-- ###################### COMMENTS ############################## -->
<!-- ############################################################## -->
<h1>{% trans 'Report Comments' %}</h1>
{% if pro_version == "1" or report.has_at_least_one_non_confidential_comment %}
{% if comment_list %}
<table>
	{% for comment in comment_list %}
	<!-- If we asked for a public version -->
	{% if not comment.is_citizen_visible and pro_version == "0" %}
		<!-- SKIP ROW if the current file annex is confidential -->
	{% elif not comment.is_confidential_visible and pro_version == "1" %}
		<!-- SKIP ROW if the current file annex is confidential -->
	{% else %}
	<tr>
		<td colspan="2">
			<strong>{% trans 'Comment title' %}</strong>
		</td>
		<td>
			<strong>{% trans 'Creation Date' %}</strong>
		</td>
		<td>
			<strong>{% trans 'Created By' %}</strong>
		</td>
	</tr>
	<tr>
		<td colspan="2">
			{{comment.text}}
		</td>
		<td>
			{{comment.created}}
		</td>
		<td>
			{% if comment.created_by %}
			{{comment.created_by.fmsuser.get_display_name}} (<a href="mailto:{{comment.created_by.fmsuser.email}}">{{comment.created_by.fmsuser.email}}</a>, {{comment.created_by.fmsuser.telephone}})
			{% else %}
			{% trans 'label_pdf_comment_value_created_by_empty' %}
			{% endif %}
		</td>
	</tr>
	{% endif %}
	{% endfor %}
</table>

{% else %}

<h3>{% trans 'No Report Comment' %}</h3>

{% endif %}
{% endif %}



<!-- ############################################################## -->
<!-- ####################### PHOTOS ############################### -->
<!-- ############################################################## -->
<hr/>
<h1>{% trans 'Report Files' %}</h1>

{% if pro_version == "1" or report.has_at_least_one_non_confidential_file %}
{% if file_list %}
<table>
	{% for file in file_list %}
	<!-- If we asked for a public version -->
	{% if not file.is_citizen_visible and pro_version == "0" %}
		<!-- SKIP ROW if the current file annex is confidential -->
	{% elif not file.is_confidential_visible and pro_version == "1" %}
		<!-- SKIP ROW if the current file annex is confidential -->
	{% else %}
        <tr>
		<td rowspan="11">
			{% if file.file_type == 1 %}
			<img width="256px" height="256px" src="{{STATIC_URL}}images/icon-pdf.png"/>
			{% endif %}
			{% if file.file_type == 2 %}
			<img width="256px" height="256px" src="{{STATIC_URL}}images/icon-word.jpg"/>
			{% endif %}
			{% if file.file_type == 3 %}
			<img width="256px" height="256px" src="{{STATIC_URL}}images/icon-excel.png"/>
			{% endif %}
			{% if file.file_type == 4 %}
			<img style="max-width:256px;max-height:256px;" src="{% if request.is_secure %}https{% else %}http{% endif %}://{{request.get_host}}{{file.file.url}}"/>
			{% endif %}
		</td>
	</tr>
	<tr>
		<td><strong>{% trans 'Creation Date' %}</strong></td>
	</tr>
	<tr>
		<td>{{file.file_creation_date}}</td>
	</tr>
	<tr>
		<td><strong>{% trans 'Publication Date' %}</strong></td>
	</tr>
	<tr>
		<td>{{file.created}}</td>
	</tr>
	<tr>
		<td>{% trans 'By' %} {{file.created_by.fmsuser.get_display_name}} {% if file.created_by %}(<a href="mailto:{{file.created_by.fmsuser.email}}">{{file.created_by.fmsuser.email}}</a>, {{file.created_by.fmsuser.telephone}}){% endif %}</td>
	</tr>
	<tr>
		<td><strong>{% trans 'City' %}</strong></td>
	</tr>
	<tr>
		<td>{{report.responsible_entity.name}}</td>
	</tr>
	<tr>
		<td><strong>{% trans 'Image Name' %}</strong></td>
	</tr>
	<tr>
		<td>{{file.title}}</td>
	</tr>
	<tr>
		<td>
			&nbsp;
		</td>
	</tr>
	{% endif %}
	{% endfor %}
</table>

{% else %}

<h3>{% trans 'No Report File' %}</h3>

{% endif %}
{% endif %}
