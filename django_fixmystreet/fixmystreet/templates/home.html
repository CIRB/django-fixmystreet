{% extends "base.html" %}
{% load i18n tags %}

{% block meta %}
<meta property="og:title" content="{% trans 'Home' %}" />
<meta property="og:description" content="{% trans 'Meta description for home page' %}" />
{% endblock %}

{% block script %}
{{ block.super }}
<script type="text/javascript" src="{{ STATIC_URL}}js/search.js"></script>

{% block script-search %}
<script type="text/javascript">
    var NEXT_PAGE_URL = '{% url "report_verify" %}';

    var zipcodes = new Object();

    {% for zip in zipcodes %}
        zipcodes[{{zip.code}}] = new Object();
        zipcodes[{{zip.code}}].participation = {{ zip.commune.active|yesno:"true,false" }};
        zipcodes[{{zip.code}}].phone = " {{zip.commune.phone}} ";
        zipcodes[{{zip.code}}].commune = "{{zip.commune.name}}";
    {% endfor %}

</script>
{% endblock %}

<script type="text/javascript">
$(function(){
    fms.currentMap = new fms.Map('map', {
        apiLang:     LANGUAGE_CODE,
        localizeUrl: URBIS_URL + '/service/urbis/Rest/Localize/getaddressfromxy',
        urbisUrl:    WMS_SERVICE_URL,
        {% if reports_created.0 %}
        origin:{
            x:{{ reports_created.0.point.x }},
            y:{{ reports_created.0.point.y }}
        }
        {% endif %}
    });

    var proVersion = false;
    {% if BACKOFFICE %}
	proVersion = true;
    {% endif %}

    /*
    >>> Based on Twitter Bootstrap in FMS 3.0
    $("#list_created").show();
    $("#list_closed").hide();
    $("#list_in_progress").hide();*/
});

/*
>>> Based on Twitter Bootstrap in FMS 3.0
function showResults(type,li){
    if(type == "created"){
        $("#list_created").show();
        $("#list_closed").hide();
        $("#list_in_progress").hide();
    }
    else if (type == "in_progress"){
        $("#list_created").hide();
        $("#list_closed").hide();
        $("#list_in_progress").show();
    }
    else {
        $("#list_created").hide();
        $("#list_closed").show();
        $("#list_in_progress").hide();
    }
    $.each(li.parent().find("li"),function(idx,val){
        $(val).removeClass("active");
    });
    li.addClass("active");
}
*/
</script>
{% endblock %}

{% block header-banner %}
    <!--h1 id="baseline">{% trans 'Report an incident' %} <small>({% trans 'Hole, degradations, subsidence, invisible marks...' %})</small></h1-->
    {% endblock %}
{% block map %}
    <div class="container">
        <div class="row">
            <div class="span12">
                <article id="map">

                    <div id="searchContainer">
                        <div id="instructions">
                            <!--h2>{% trans "How to fill a report" %}</h2>
                            <p class="callpolice">{% trans "call police"  %}</p>
                            <ol>
                                <li>{% trans "Enter a street where you have located an incident" %}</li>
                                <li>{% trans "Locate the incident on map" %}</li>
                                <li>{% trans "Descibe the incident" %}</li>
                                <li>{% trans "The incident will be sent to the right service" %}</li>
                                <li>{% trans "Subscribe an incident to be kept posted" %}</li>
                            </ol-->
                            <div class="row">
                                <div class="span8">
                                    <ol class="steps">
                                        <li class="stepOne on">{% trans "Localisation" %}</li>
                                        <li id="stepDescription" class="stepTwo off">{% trans "Description" %}</li>
                                        <li id="stepCoordonnees" class="stepThree off">{% trans "Coordonnees" %}</li>
                                    </ol>
                                </div>
                                <div>
                                    <strong id="danger-risk"><a href="#"><i class="icon-danger"></i>{% trans "A big security risk to signal?" %}</a></strong>
                                </div>
                            </div>
                        </div>
                        <div id="newReport">
                            <div class="row">
                                <div class="span12">
                                    <div id="search-form" class="block highlighted">
                                        <form id="search-address-form" class="form-inline search-form">
                                            <div id="address-search-div">
                                                <!--h2>{% trans "Enter the address where the incident is:" %}</h2-->
                                                <input id="input-search" class="input-xxlarge" type="search" name="q" {% if location %}value="{{location}}"{% endif %} placeholder="{% trans 'Street name, Street number...' %}" />
                                                <input id="input-streetnumber"  placeholder="n°" class="input-mini" type="search" />
                                                <select id="input-ward" class="input-large" name="ward">
                                                    <option value="">{% trans "All communes..." %}</option>
                                                    {% for zip in zipcodes %}
                                                        <option value={{zip.code}}>{{zip.code}} {{zip.name}}</option>
                                                    {% endfor %}
                                                </select>
                                                <input id="widget-search-button" class="btn" type="submit" name="submit" value="{% trans 'Signaler' %}" disabled>
                                            </div>
                                        </form>

                                        <!--form id="search-ticket-form" class="form-inline">
                                            <h2>{% trans "Enter the report ticket:" %}</h2>
                                            <input id="input-ticket-search" class="input-large" type="search" name="q" {% if location %}value="{{location}}"{% endif %} placeholder="{% trans 'Ticket number...' %}" />
                                            <input id="widget-search-ticket-button" class="btn" type="submit" name="submit" value="{% trans 'Access Ticket' %}">
                                        </form-->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Results -->
                        <div>
                            <p id="proposal-message" class="hide"> </p>
                            <ul id="proposal" class="inline hide"> </ul>
                        </div>

                    </div>

                    <div id="copyright-urbis">Realized by means of Brussels UrbIS®©</div>
                    <div id="btn-localizeviamap"><a href="#"><i class="icon-localizeviamap"></i>{% trans "Localiser via la carte" %}</a></div>
                </article>
            </div>
        </div>
    </div>

{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <article id="recent-reports" class="home_recent_reports span12">
                <!--h2>{% trans 'Last modified reports:' %}</h2-->
                <div class="row">
                    <ul id="recent_home_nav" class="nav nav-tabs span12">
                        <li>
                            <h2 class="last_reports">{% trans 'Last 30 days' %}</h2>
                        </li>
                        <li class="">
                            <a href="#list_created" data-toggle="tab"><span class="num_reports">{{ report_counts.recent_new }}</span><br />{% trans "Report Created" %}</a>
                        </li>
                        <li class="active">
                            <a href="#list_in_progress" data-toggle="tab"><span class="num_reports">{{ report_counts.recent_updated }}</span><br />{% trans "Report In progress" %}</a>
                        </li>
                        <li class="">
                            <a href="#list_closed" data-toggle="tab"><span class="num_reports">{{ report_counts.recent_fixed }}</span><br />{% trans "Report Processed" %}</a>
                        </li>
                        <li class="search-ticket">
                            <form id="search-ticket-form" class="form-inline">
                                <!--h2>{% trans "Enter the report ticket:" %}</h2-->
                                <input id="input-ticket-search" class="input-large" type="search" name="q" {% if location %}value="{{location}}"{% endif %} placeholder="{% trans 'Ticket number...' %}" />
                                <input id="widget-search-ticket-button" class="btn" type="submit" name="submit" value="">
                            </form>
                        </li>
                    </ul>
                </div>
                <div id="search_results" class="search_results_home tab-content">
                    <div id="list_created" class="tab-pane">
                        <div class="row">
                            {% for report in reports_created %}
                            {% if not BACKOFFICE %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url %}
                            {% else %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url_pro %}
                            {% endif %}
                            {% endfor %}
                            <div class="clearfloat"></div>
                        </div>
                    </div>
                    <div id="list_in_progress" class="tab-pane active">
                        <div class="row">
                            {% for report in reports_in_progress %}
                            {% if not BACKOFFICE %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url %}
                            {% else %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url_pro %}
                            {% endif %}
                            {% endfor %}
                            <div class="clearfloat"></div>
                        </div>
                    </div>
                    <div id="list_closed" class="tab-pane">
                        <div class="row">
                            {% for report in reports_closed %}
                            {% if not BACKOFFICE %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url %}
                            {% else %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url_pro %}
                            {% endif %}
                            {% endfor %}
                            <div class="clearfloat"></div>
                        </div>
                    </div>
                </div>
            </article>
        </div>
    </div>

    <!--div class="span6">
        {% block statistics %}
        <article id="counters">
            <div class='counter'>
                <p class='number lead'>{{ report_counts.recent_new }}</p>
                <p class='text'>{% trans "Report Created" %}</p>
                <p class='qualifier'>{% trans "In the 30 last days" %}</p>
            </div>
            <div class='counter'>
                <p class='number lead'>{{ report_counts.recent_updated }}</p>
                <p class='text'>{% trans "Report In progress" %}</p>
                <p class='qualifier'>{% trans "In the 30 last days" %}</p>
            </div>
            <div class='counter'>
                <p class='number lead'>{{ report_counts.recent_fixed }}</p>
                <p class='text'>{% trans "Report Processed" %}</p>
                <p class='qualifier'>{% trans "In the 30 last days " %}</p>
            </div>
        </article>
        {% endblock %}

        <article id="home_download_mobile">
            <p>{% trans 'Download Fix My Street for your smartphone:' %}</p>

            <a href="https://itunes.apple.com/be/app/fixmy-street-bruxelles/id624618373?ls=1&amp;mt=8">
                <img src="{{STATIC_URL}}images/app-store.png" alt="App Store">
            </a>

            <a href="https://play.google.com/store/apps/details?id=be.irisnet.fixmystreet">
                <img src="{{STATIC_URL}}images/google-play.png" alt="Google Play" class="pull-right">
            </a>
        </article>
    </div-->
{% endblock %}

{% block content_third %}{% endblock %}
