{% extends "base.html" %}
{% load i18n tags %}

{% block script %}
{{ block.super }}

<meta property="og:title" content="{% trans 'Home' %}" />
<meta property="og:description" content="{% trans 'Meta description for home page' %}" />

<script type="text/javascript" src="{{ STATIC_URL}}js/search.js"></script>

{% block script-search %}
<script type="text/javascript">
    var NEXT_PAGE_URL = '{% url report_new %}';
</script>


{% endblock %}
<script type="text/javascript">
$(function(){
    fms.currentMap = new fms.Map('map', {
        apiLang:     LANGUAGE_CODE,
        localizeUrl: GEOSERVER_URL + '/service/urbis/Rest/Localize/getaddressfromxy',
        urbisUrl:    GEOSERVER_URL + '/geoserver/wms',
        origin:{
            x:{{ reports.0.point.x }},
            y:{{ reports.0.point.y }}
        }
    });
    {% for report in reports %}
    fms.currentMap.addReport({{ report.to_JSON|dict_to_json|safe }}, {{forloop.counter}});
    {% endfor %}

});
</script>
{% endblock %}

{% block content %}
<div id="page_content_container">
    <article id="map">

        <div id="instructions" class="block">
            <p class="lead">{% trans "How to fill a report" %}</p>
            <ol>
                <li>{% trans "Enter a street" %}</li>
                <li>{% trans "Locate the problem on map" %}</li>
                <li>{% trans "Descibe the problem" %}</li>
                <li>{% trans "We send it to the city on your behalf" %}</li>
            </ol>
        </div>

        <form id='search-form' class="block highlighted form-inline">
            <p class="lead">{% trans "Enter the address where the incident is:" %}</p>
            <input id="input-search" class="input-large" type="search" name="q" {% if location %}value="{{location}}"{% endif %} placeholder="{% trans 'Street...' %}" />
            <select id="input-ward" class="input-medium" name="ward">
                <option value="">{% trans "All communes..." %}</option>
                {% for zip in zipcodes %}
                    <option value={{zip.code}}>{{zip.code}} {{zip.name}}</option>
                {% endfor %}
            </select>
            <input class="btn" type="submit" name="submit" value="{% trans 'Search' %}">


            <ul id="proposal" class="inline"> </ul>

        </form>
    </article>

    <article id="counters">
        <div class='counter'>
            <h3 class='number'>{{ report_counts.recent_new }}</h3>
            <span class='text'>{% trans "Reports Filed" %}</span>
            <span class='qualifier'>{% trans "In the Last Year" %}</span>
        </div>
        <div class='counter'>
            <h3 class='number'>{{ report_counts.recent_fixed }}</h3>
            <span class='text'>{% trans "Reports Fixed" %}</span>
            <span class='qualifier'>{% trans "In the Last Year" %}</span>
        </div>
        <div class='counter'>
            <h3 class='number'>{{ report_counts.recent_updated }}</h3>
            <span class='text'>{% trans "Reports Updated" %}</span>
            <span class='qualifier'>{% trans "In the Last Year" %}</span>
        </div>
    </article>


    <article id="recent-reports" class="home_recent_reports">
        <h4>{% trans 'Last modified reports:' %}</h4>
        <ul id="recent_home_nav" class="nav nav-tabs">
            <li class="active">
                <a href="#">{% trans "Incidents signalés" %}</a>
            </li>
            <li>
                <a href="#">{% trans "Incidents mis a jour" %}</a>
            </li>
            <li>
                <a href="#">{% trans "Incidents cloturés" %}</a>
            </li>
        </ul>
        <div id="search_results" class="search_results_home">
        {% for report in reports %}
        {% include "reports/_navigation.html" with url=report.get_absolute_url %}
        {% endfor %}
    </div>
    </article>

    <article id="home_download_mobile">
        <p>{% trans 'Download the fix my street mobile application for your smartphone:' %}</p>
        <img src="{{STATIC_URL}}images/app-store.png">
        <img src="{{STATIC_URL}}images/google-play.png">
    </article>
</div>
{% endblock %}

{% block content_third %}{% endblock %}
