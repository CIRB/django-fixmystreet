{% extends "base.html" %}
{% load i18n tags %}

{% block meta %}
<meta property="og:title" content="{% trans 'Home' %}" />
<meta property="og:description" content="{% trans 'Meta description for home page' %}" />
{% endblock %}

{% block script %}
{{ block.super }}
<script type="text/javascript" src="{{ STATIC_URL}}js/search.js"></script>

{% block script-search %}
<script type="text/javascript">
    var NEXT_PAGE_URL = '{% url "report_verify" %}';

    var zipcodes = new Object();

    {% for zip in zipcodes %}
        zipcodes[{{zip.code}}] = new Object();
        zipcodes[{{zip.code}}].participation = {{ zip.commune.active|yesno:"true,false" }};
        zipcodes[{{zip.code}}].phone = " {{zip.commune.phone}} ";
        zipcodes[{{zip.code}}].commune = "{{zip.commune.name}}";
    {% endfor %}

</script>
{% endblock %}

<script type="text/javascript">
$(function(){
    fms.currentMap = new fms.Map('map', {
        apiLang:     LANGUAGE_CODE,
        localizeUrl: URBIS_URL + '/service/urbis/Rest/Localize/getaddressfromxy',
        urbisUrl:    WMS_SERVICE_URL,
        {% if reports_created.0 %}
        origin:{
            x:{{ reports_created.0.point.x }},
            y:{{ reports_created.0.point.y }}
        }
        {% endif %}
    });

    var proVersion = false;
    {% if BACKOFFICE %}
	proVersion = true;
    {% endif %}
});

</script>
{% endblock %}

{% block header-banner %}
    <!--h1 id="baseline">{% trans 'Report an incident' %} <small>({% trans 'Hole, degradations, subsidence, invisible marks...' %})</small></h1-->
    {% endblock %}
{% block map %}
    <div class="row">
        {% include "_map_search.html" with instructions=True %}
    </div>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <article id="recent-reports" class="home_recent_reports span12">
                <!--h2>{% trans 'Last modified reports:' %}</h2-->
                <div class="row">
                    <ul id="recent_home_nav" class="nav nav-tabs span12">
                        <li>
                            <h2 class="last_reports">{% trans 'Last 30 days' %}</h2>
                        </li>
                        <li class="">
                            <a href="#list_created" data-toggle="tab"><span class="num_reports">{{ report_counts.recent_new }}</span><br />{% trans "Report Created" %}</a>
                        </li>
                        <li class="active">
                            <a href="#list_in_progress" data-toggle="tab"><span class="num_reports">{{ report_counts.recent_updated }}</span><br />{% trans "Report In progress" %}</a>
                        </li>
                        <li class="">
                            <a href="#list_closed" data-toggle="tab"><span class="num_reports">{{ report_counts.recent_fixed }}</span><br />{% trans "Report Processed" %}</a>
                        </li>
                        <li class="search-ticket">
                            <form id="search-ticket-form" class="form-inline">
                                <!--h2>{% trans "Enter the report ticket:" %}</h2-->
                                <input id="input-ticket-search" class="input-large" type="search" name="q" {% if location %}value="{{location}}"{% endif %} placeholder="{% trans 'Ticket number...' %}" />
                                <input id="widget-search-ticket-button" class="btn" type="submit" name="submit" value="">
                            </form>
                        </li>
                    </ul>
                </div>
                <div id="search_results" class="search_results_home tab-content">
                    <div id="list_created" class="tab-pane">
                        <div class="row">
                            {% for report in reports_created %}
                            {% if not BACKOFFICE %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url %}
                            {% else %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url_pro %}
                            {% endif %}
                            {% endfor %}
                            <div class="clearfloat"></div>
                        </div>
                    </div>
                    <div id="list_in_progress" class="tab-pane active">
                        <div class="row">
                            {% for report in reports_in_progress %}
                            {% if not BACKOFFICE %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url %}
                            {% else %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url_pro %}
                            {% endif %}
                            {% endfor %}
                            <div class="clearfloat"></div>
                        </div>
                    </div>
                    <div id="list_closed" class="tab-pane">
                        <div class="row">
                            {% for report in reports_closed %}
                            {% if not BACKOFFICE %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url %}
                            {% else %}
                            {% include "reports/_navigation.html" with url=report.get_absolute_url_pro %}
                            {% endif %}
                            {% endfor %}
                            <div class="clearfloat"></div>
                        </div>
                    </div>
                </div>
            </article>
        </div>
    </div>
{% endblock %}

{% block content_third %}{% endblock %}
