{% extends "base.html" %}
{% load i18n tags %}

{% block script %}
{{ block.super }}

<meta property="og:title" content="{% trans 'Home' %}" />
<meta property="og:description" content="{% trans 'Meta description for home page' %}" />

<script type="text/javascript" src="{{ STATIC_URL}}js/search.js"></script>

{% block script-search %}
<script type="text/javascript">
    var NEXT_PAGE_URL = '{% url "report_new" %}';
</script>


{% endblock %}
<script type="text/javascript">
$(function(){
    fms.currentMap = new fms.Map('map', {
        apiLang:     LANGUAGE_CODE,
        localizeUrl: URBIS_URL + '/service/urbis/Rest/Localize/getaddressfromxy',
        urbisUrl:    WMS_SERVICE_URL,
        {% if reports_created.0 %}
        origin:{
            x:{{ reports_created.0.point.x }},
            y:{{ reports_created.0.point.y }}
        }
        {% endif %}
    });

    var proVersion = false;
    {% if BACKOFFICE %}
	proVersion = true;
    {% endif %}

    $("#list_created").show();
    $("#list_closed").hide();
    $("#list_in_progress").hide();
});

function showResults(type,li){
    if(type == "created"){
        $("#list_created").show();
        $("#list_closed").hide();
        $("#list_in_progress").hide();
    }
    else if (type == "in_progress"){
        $("#list_created").hide();
        $("#list_closed").hide();
        $("#list_in_progress").show();
    }
    else {
        $("#list_created").hide();
        $("#list_closed").show();
        $("#list_in_progress").hide();
    }
    $.each(li.parent().find("li"),function(idx,val){
        $(val).removeClass("active");
    });
    li.addClass("active");
}
</script>
{% endblock %}

{% block header-banner %}
    <h1 id="baseline">{% trans 'Report an incident' %} <small>({% trans 'Hole, degradations, subsidence, invisible marks...' %})</small></h1>
{% endblock %}
{% block map %}
     <article id="map">
        <div id="instructions" class="block">
            <h2>{% trans "How to fill a report" %}</h2>
            <p class="callpolice">{% trans "call police"  %}</p>
            <ol>
                <li>{% trans "Enter a street where you have located an incident" %}</li>
                <li>{% trans "Locate the incident on map" %}</li>
                <li>{% trans "Descibe the incident" %}</li>
                <li>{% trans "The incident will be sent to the right service" %}</li>
                <li>{% trans "Subscribe an incident to be kept posted" %}</li>
            </ol>
        </div>

        <div id="search-form" class="block highlighted">
            <form id="search-address-form" class="form-inline search-form">
                <div id="address-search-div">
                    <h2>{% trans "Enter the address where the incident is:" %}</h2>
                    <input id="input-search" class="input-large" type="search" name="q" {% if location %}value="{{location}}"{% endif %} placeholder="{% trans 'Street name, Street number...' %}" />
                    <select id="input-ward" class="input-medium" name="ward" onchange="document.getElementById('widget-search-button').click()">
                        <option value="">{% trans "All communes..." %}</option>
                        {% for zip in zipcodes %}
                            <option value={{zip.code}}>{{zip.code}} {{zip.name}}</option>
                        {% endfor %}
                    </select>
                    <input id="widget-search-button" class="btn" type="submit" name="submit" value="{% trans 'Widget Search' %}">
                    <ul id="proposal" class="inline hide"> </ul>
                </div>
            </form>

            <form id="search-ticket-form" class="form-inline">
                <!-- Search per ticket -->
                <h2>{% trans "Enter the report ticket:" %}</h2>
                <input id="input-ticket-search" class="input-large" type="search" name="q" {% if location %}value="{{location}}"{% endif %} placeholder="{% trans 'Ticket number...' %}" />
                <input id="widget-search-ticket-button" class="btn" type="submit" name="submit" value="{% trans 'Access Ticket' %}">
            </form>
        </div>

        <div id="copyright-urbis">Realized by means of Brussels UrbIS®©</div>
    </article>
{% endblock %}

{% block content %}
    <article id="recent-reports" class="home_recent_reports span6">
        <h4>{% trans 'Last modified reports:' %}</h4>
        <ul id="recent_home_nav" class="nav nav-tabs">
            <li class="active">
                <a onclick="showResults('created',$(this).parent());">{% trans "Report Created" %}</a>
            </li>
            <li class="">
                <a onclick="showResults('in_progress',$(this).parent());">{% trans "Report In progress" %}</a>
            </li>
            <li class="">
                <a onclick="showResults('closed',$(this).parent());">{% trans "Report Processed" %}</a>
            </li>
        </ul>
        <div id="search_results" class="search_results_home">
            <div id="list_created">
                {% for report in reports_created %}
                {% if not BACKOFFICE %}
                {% include "reports/_navigation.html" with url=report.get_absolute_url %}
                {% else %}
                {% include "reports/_navigation.html" with url=report.get_absolute_url_pro %}
                {% endif %}
                {% endfor %}
            </div>
            <div id="list_in_progress">
                {% for report in reports_in_progress %}
                {% if not BACKOFFICE %}
                {% include "reports/_navigation.html" with url=report.get_absolute_url %}
                {% else %}
                {% include "reports/_navigation.html" with url=report.get_absolute_url_pro %}
                {% endif %}
                {% endfor %}
            </div>
            <div id="list_closed">
                {% for report in reports_closed %}
                {% if not BACKOFFICE %}
                {% include "reports/_navigation.html" with url=report.get_absolute_url %}
                {% else %}
                {% include "reports/_navigation.html" with url=report.get_absolute_url_pro %}
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </article>

    <div class="span6">
        {% block statistics %}
        <article id="counters">
            <div class='counter'>
                <p class='number lead'>{{ report_counts.recent_new }}</p>
                <p class='text'>{% trans "Report Created" %}</p>
                <p class='qualifier'>{% trans "In the 30 last days" %}</p>
            </div>
            <div class='counter'>
                <p class='number lead'>{{ report_counts.recent_updated }}</p>
                <p class='text'>{% trans "Report In progress" %}</p>
                <p class='qualifier'>{% trans "In the 30 last days" %}</p>
            </div>
            <div class='counter'>
                <p class='number lead'>{{ report_counts.recent_fixed }}</p>
                <p class='text'>{% trans "Report Processed" %}</p>
                <p class='qualifier'>{% trans "In the 30 last days " %}</p>
            </div>
        </article>
        {% endblock %}

        <article id="home_download_mobile">
            <p>{% trans 'Download Fix My Street for your smartphone:' %}</p>

            <a href="https://itunes.apple.com/be/app/fixmy-street-bruxelles/id624618373?ls=1&amp;mt=8">
                <img src="{{STATIC_URL}}images/app-store.png" alt="App Store">
            </a>

            <a href="https://play.google.com/store/apps/details?id=be.irisnet.fixmystreet">
                <img src="{{STATIC_URL}}images/google-play.png" alt="Google Play" class="pull-right">
            </a>
        </article>
    </div>
{% endblock %}

{% block content_third %}{% endblock %}
