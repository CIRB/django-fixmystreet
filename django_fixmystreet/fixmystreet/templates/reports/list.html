{% extends "base.html" %}
{% load i18n %}
{% load tags %}
{% block title %}{% trans "Reports for" %} {{entity.name}}{% endblock %}
{% block css %}
{{ block.super }}

{% endblock %}

{% block script %}
{{ block.super }}

<meta property="og:title" content="{% trans 'Reports for' %} {{entity.name}}" />
<meta property="og:description" content="{% trans 'Meta description for list page' %}" />
<script>
$(function(){
    var defaultX = 148838.00741428943;
    var defaultY = 171086.0720425099;

    {% if reports.0 %}
        defaultX = {{reports.0.point.x}}
        defaultY = {{reports.0.point.y}}
    {% endif %}


    // $('#map-bxl').fmsMap();
 //    $('#map-bxl').fmsMap('highlightArea', '{{ entity.feature_id }}');

    // {% for report in reports %}
    // $('#map-bxl').fmsMap('addReport',  {{ report.to_JSON|dict_to_json|safe }}, {{ forloop.counter }});
    // {% endfor %}

    // $('#map-bxl').bind('reportselected',function(evt, point, report){
    //     window.location.assign('{{report.get_absolute_url}}');
    // });

    fms.currentMap = new fms.Map('map', {
        apiLang:     LANGUAGE_CODE,
        localizeUrl: URBIS_URL + '/service/urbis/Rest/Localize/getaddressfromxy',
        urbisUrl:    URBIS_URL + '/geoserver/wms',
        origin:{
            x: defaultX,
            y: defaultY
        }
    });
    {% for report in reports %}
            fms.currentMap.addReport({{ report.to_JSON|dict_to_json|safe }}, {{forloop.counter}}, {% if BACKOFFICE %}true{%else%}false{%endif%});
    {% endfor %}
});


</script>
{% endblock %}

{% block map %}
<article id="map"></article>
{% endblock %}

{% block content %}
<div class="">
    <div id="incident_filter" class="span12">
        <ul>
            <li>
                    <img src="{{STATIC_URL}}images/pin-red-L.png"> <span>{% trans 'Unpublished' %}</span>
            </li>
            <li>
                    <img src="{{STATIC_URL}}images/pin-orange-L.png"> <span>{% trans 'Report In progress' %}</span>
            </li>
            <li>
                    <img src="{{STATIC_URL}}images/pin-green-L.png"> <span>{% trans 'Closed' %}</span>
            </li>
        </ul>
    </div>

    <h1 class="span12">{% trans "Reports for" %} {{entity.name}}</h1>
    <div id="search_results" class='span8'>
    {% if not reports %}
        {% trans "No problems have been reported." %}
    {% else %}
        {% for report in reports %}
            {% include "reports/_navigation.html" with url=report.get_absolute_url %}
        {% endfor %}
        {% include "_paginator.html" %}
    {% endif %}
    </div>

    <div class='span4'>
        <form action="{% url search_ticket %}" class="block highlighted" id="search_by_ticket_nr">
            <h2>{% trans "Search by ticket number:" %}</h2>
            <div class="form-search">
                <input id="input-search" type="search" name="report_id" placeholder="{% trans 'Ticket number' %}">
                <input type="submit" class="btn" id="filterReports" value="{% trans 'Search' %}"/>
            </div>
        </div>
   </div>
{% endblock %}
