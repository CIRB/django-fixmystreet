{% extends "base.html" %}
{% load i18n tags %}
{% block title %}{{report.secondary_category.name}} {{report.secondary_category.secondary_category_class.name.lower}} {{report.category.name.lower}} {% trans 'in' %} {{report.responsible_entity.name}}{% endblock %}

{% block script %}
{{ block.super }}


<meta property="og:title" content="{{report.secondary_category.name}} {{report.secondary_category.secondary_category_class.name.lower}} {{report.category.name.lower}} {% trans 'in' %} {{report.responsible_entity.name}}" />
<meta property="og:description" content="{% trans 'Signalez tout type d incident :' %} {{report.secondary_category.name}} {{report.secondary_category.secondary_category_class.name.lower}} {{report.category.name.lower}} {% trans 'in' %} {{report.responsible_entity.name}} {% trans 'sur FixMyStreet qui identifiera alors le service public en charge de le traiter. '%}" />
{% addthis_scripts %}
{% map_scripts %}

<script src="{{ STATIC_URL }}js/attachmentForms.js"></script>
<script>
/******************************/
/* QUERY READY INITIALIZATION */
/******************************/
$(function(){
	$('#map-bxl').fmsMap({ 
		origin:{
			x:{{ report.point.x }},
			y:{{ report.point.y }} 
		}
	});
	$('#map-bxl').fmsMap('addReport', {% report_to_json report %});
});

</script>
{% endblock %}
{% block css %}

{{block.super}}

<!-- ##################### -->
<!-- # SPECIFIC CSS ZONE # -->
<!-- ##################### -->

<style type="text/css" media="screen">
    #update-header {
        float: left;
        width: 100%;
    }
    
    #update-title {
        float: left;
        width: 48%;
    }
    
    #update-email-me {
        float: right;
        width: 48%;
        text-align: right;
        margin-top: 4px;
    }
</style>
{% endblock %}
{% block content %}

<!-- ######################### -->
<!-- # MAIN CONTENT DEFINITION -->
<!-- ######################### -->
<div id="page_content_container">

{% block pageHeader %}
<h1>
    <!-- ########################### -->
    <!-- # DISPLAY REPORT CATEGORY # -->
    <!-- ########################### -->
    {% trans "Report Ticket" %}: {{report.get_ticket_as_string}}
 	<div style="float:right;margin-top:-23px">
        	<table class="reportActionButtons">
			<tr>
				<td>
					<button onclick="window.location = '{% url report_pdf report.id 0 %}'" class="saveFormButton" style="font-size: 0.4em;margin-top: 0px;width:100%;">{% trans 'report pdf public' %}</button>
				</td>
				{% if report.is_in_progress %}
				<td>
					<button onclick="window.location = '{% url report_update report.id %}?is_fixed=True'" class="saveFormButton" style="font-size: 0.4em;margin-top: 0px;width:100%;">{% trans 'Mark as done' %}</button>
				</td>
				{% endif %}
			</tr>
		</table>
	</div>
</h1>
    {% endblock %}

	<div id="leftcol">    
		<!-- ######### -->
		<!-- IS FIXED  -->
		<!-- ######### -->
		{% if report.is_fixed %}
			<div class='is_fixed'>{% trans "This problem has been fixed." %}</div>
		{% endif %}

		<div id='report-body'>
            
		<!-- ################ -->
		<!-- SUBSCRIBER BLOCK -->
		<!-- ################ -->
		<div id='report-subscribers'>
                	{% trans "Subscribers:" %} <b>{{report.subscriptions.count}}</b><br/>
                	{% if not report.is_closed and not subscribed %}
                        <form action="{% url subscribe report.id %}">
                            <p class="required"><input type="text" value="" placeholder="Your Email" name="citizen_email" /></p>
                            <input type="submit" value="{% trans "Subscribe" %}" />
                        </form>
                	{% endif %}
            	</div>

			<p>{{report.description|linebreaks}}</p>

		<!-- ################### -->
		<!-- REPORT CREATOR ZONE -->
		<!-- ################### -->
		<p class="author-sign">
                {% blocktrans with by=author.get_full_name on=report.created|date %}
                	Posted by <strong>{{by}}</strong> on <strong>{{on}}</strong>
                {% endblocktrans %}
            </p>


	<!-- ################## -->
	<!-- REPORT STATUS ZONE -->
	<!-- ################## -->
            <table id='report-status'>			
                <tr>
                    <th>{% trans "Location:" %}</th>
                    <td>{{report.address}} ({{report.postalcode}} {{report.ward.name}})</td>
                </tr>
                <tr>
                    <th>{% trans "Category:" %}</th>
                    <td>{{report.category.name}} / {{report.secondary_category.name}}</td>
                </tr>
            </table>


	    <!-- ################# FILES ############### -->
	    <!-- ################# FILES ############### -->
	    <!-- ################# FILES ############### -->
	    {% if report.get_files %}
            <h3>{% trans "Extra files" %}</h3>
            <div id="report_updates">
                <table id="extraFilesTable">
                    {% for file in report.get_files %}
		    {% if file.validated %} <!-- PUBLIC? -->
                    <tr>
                        <td class="annexesFirstTD">
                    <div class="report_update">
                        {% if file.file %}
                                <center>
                                        <!--img style="max-width:390px;max-heigth:390px" src='{{ file.file.url }}'/-->
                                        {{file.title}}
                                        {% if file.is_image %}
                                                <a href="{{ file.file.url }}" ><img style="max-width:390px;max-heigth:390px" src='/static/images/icon-jpeg.png' width="48px" height="48px"/></a>
                                        {% endif %}
                                        {% if file.is_pdf %}
                                                <a href="{{ file.file.url }}" ><img style="max-width:390px;max-heigth:390px" src='/static/images/icon-pdf.png' width="48px" height="48px"/></a>
                                        {% endif %}
                                        {% if file.is_word %}
       <a href="{{ file.file.url }}" ><img style="max-width:390px;max-heigth:390px" src='/static/images/icon-doc.png' width="48px" height="48px"/></a>
                                        {% endif %}
                                        {% if file.is_excel %}
                                                <a href="{{ file.file.url }}" ><img style="max-width:390px;max-heigth:390px" src='/static/images/icon-png.png' width="48px" height="48px"/> </a>
                                        {% endif %}
                                </center>
                        {% endif %}
                    </div>
                </td>
		</tr>
		{% endif %}
		{% endfor %}
		</table>
	</div>
	{% endif %}





	    <!-- ################# COMMENTS ############### -->
	    <!-- ################# COMMENTS ############### -->
	    <!-- ################# COMMENTS ############### -->
	    {% if report.get_comments %}
            <h3>{% trans "Extra comments" %}</h3>
            <div id="report_updates">
                <table class="extraCommentsTable">
                {% for comment in report.get_comments %}
		{% if comment.validated %} 
                	<tr>
                    	<td class="annexesFirstTD">
                		<div class="report_update">
                    			<p>{{comment.text}}</p>
                		</div>
            		</td>
			</tr>
		{% endif %}
		{% endfor %}
		</table>
	</div>
	{% endif %}


            <!-- If the status allow such interactions -->


			<div id="more-actions">
				<p><a href='{% url flag_report report.id %}'>{% trans "Offensive? Unsuitable? Tell us" %}</a></p>
			</div>

			{% if report.is_in_progress %} 
		<!-- ############################################# -->
		<!-- # ONLY AVAILABLE WHEN REPORT IS IN PROGRESS # -->
		<!-- ############################################# -->
		<div id="addCommmentDiv">
			<h2>{% trans "Add a comment to this report" %}</h2>
            		<input id="showCommentFormButton" type="button" class="big_button" onclick="toggleCommentForm();" value="Add"/>

			<form id="commentForm" enctype="multipart/form-data" action="{% url report_update report.id %}" method="post">
			<table id="report_form" class="form">
				{{comment_form.as_table}}					
				<tr>
                        	<td></td>
                        	<td>
                            		<p style="float:left;">
                            		<input type="hidden" name="form-type" value="comment-form"/>
                                	<input type="submit" class='big_button' value="{% trans 'Add' %}" onclick="setTimeout('toggleCommentForm()',200);"/>
                                	<input type="button" class='big_button' value="{% trans 'Cancel' %}" onclick="toggleCommentForm();"/>
                            		</p>
                        	</td>
                   	 	</tr>
			</table>
			</form>
        	</div>
		<!-- ############################################# -->
		<!-- # ONLY AVAILABLE WHEN REPORT IS IN PROGRESS # -->
		<!-- ############################################# -->
		<div id="addFileDiv">
		<h2>{% trans "Add a file to this report" %}</h2>
            		<input id="showFileFormButton" type="button" class="big_button" onclick="toggleFileForm();" value="Add"/>
			<form id="fileForm" enctype="multipart/form-data" action="{% url report_update report.id %}" method="post">
			<table id="report_form" class="form">
				{{file_form.as_table}}					
				<tr>
                        	<td></td>
                        	<td>
                            		<p style="float:left;">
                            		<input type="hidden" name="form-type" value="file-form"/>
                                	<input type="submit" class='big_button' value="{% trans 'Add' %}" onclick="setTimeout('toggleFileForm()',200);"/>
                                	<input type="button" class='big_button' value="{% trans 'Cancel' %}" onclick="toggleFileForm();"/>
                            	</p>
                        	</td>
                    		</tr>
			</table>
			</form>
		</div>
		{% endif %}
		</div>
	</div>
	<!-- ############## -->
	<!-- # MAP WIDGET # -->
	<!-- ############## -->
	<div id="rightcol">
     		<div id="map-bxl" ></div>
    	</div>
</div>

{% endblock %}