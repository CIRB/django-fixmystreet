{% extends "base.html" %}
{% load i18n tags %}
{% block title %}{% trans "New Report" %}{% endblock %}

{% block meta %}
<meta property="og:title" content="{% trans 'New Report' %}" />
<meta property="og:description" content="{% trans 'Signalez tout type d incident. Sur fix my street qui identifiera alors le service public en charge de le traiter.' %}" />
{% endblock %}


{% block script %}
{{ block.super }}
<script src="{{ STATIC_URL }}js/attachmentForms.js"></script>
<script src="{{ STATIC_URL }}js/categorySelection.js"></script>
<script src="{{ STATIC_URL }}js/new_report.js"></script>

<script>
    var zipcodes = new Object();

    {% for zip in all_zips %}
    zipcodes[{{zip.code}}] = new Object();
    zipcodes[{{zip.code}}].participation = {{ zip.commune.active|yesno:"true,false" }};
    zipcodes[{{zip.code}}].phone = " {{zip.commune.phone}} ";
    zipcodes[{{zip.code}}].commune = "{{zip.commune.name}}";
    {% endfor %}

    $(function(){
        var proVersion = {{ BACKOFFICE|yesno:'true,false' }};

        $("input:checkbox").attr("value","off");
        $("input:checkbox").bind("change",function(){

            if ($(this).attr("value")!="on"){
                $(this).attr("value","on");
            }
            else {
                if($(this).attr("checked")=="checked"){
                    $(this).attr("value","on");
                    return false;
                }
                $(this).attr("value","off");
            }
        });

        $('#form-files').find('textarea').attr('placeholder',"{% trans 'Your file description' %}");
    });


    var categories = {
        {% for category_class in category_classes %}
        "{{ category_class.id }}": {
            {% for category in category_class.categories.all %}
                "{{ category.id }}": {
                    "label": "{{ category.name }}",
                    "class": "{{ category.secondary_category_class.id }}",
                    "public": {{ category.public|yesno:"true,false" }}
                }{% if not forloop.last %},{% endif %}
            {% endfor %}
            }{% if not forloop.last %},{% endif %}
        {% endfor %}
    }

    var description = document.getElementById('description');
    var coordonnees = document.getElementById('coordonnees');

    document.getElementById('nextStep').addEventListener('click', function() {
        description.hidden = true;
        coordonnees.hidden = false;
    });

    document.getElementById('previousStep').addEventListener('click', function() {
        coordonnees.hidden = true;
        description.hidden = false;
    });
</script>
{% endblock %}

{% block map %}{% endblock %}

{% block content %}

<h2  id="address-text"></h2>

<form enctype="multipart/form-data" method="post" action="" id="report-form" class="form-horizontal">
    <div id="description" class="span6" style="margin-top: 30px;">
        <div id="create_form_left" class="bordered-box">

            {% block report_form %}
            <fieldset>
                <legend>{% trans "Incident category:" %}</legend>
                {% for field in report_form.hidden_fields %}
                    {{ field }}
                {% endfor %}
                {% include "_field_horizontal.html" with field=report_form.category %}
                {% include "_field_horizontal.html" with field=report_form.secondary_category %}
            </fieldset>
            {% endblock %}

            {% include "reports/_attachments_form.html" with display_citizen_form_comment=False %}
        </div>

        <p><a id="nextStep">Etape suivante</a></p>
    </div>

    <div id="coordonnees" class="span6" style="margin-top: 30px;" hidden>
        {% if citizen_form %}
        <div id="user_information_form" class="bordered-box overview_div_right">
            <fieldset>
                <legend>{% trans 'Contact information:' %}</legend>
                {% include "_form_horizontal.html" with form=citizen_form %}
            </fieldset>
        </div>
        {% endif %}
        <div id="validate_form" class="bordered-box overview_div_right">
            <fieldset>
                <legend>{% trans 'Subscription:' %}</legend>
                {% include "_field_horizontal.html" with field=report_form.subscription %}
            </fieldset>
        </div>
        {% if not BACKOFFICE %}
            {% include "_field_horizontal.html" with field=report_form.terms_of_use_validated %}
        {% endif %}
        <div class="warning_information_form">
            <button id="validate_button" class="btn pull-right"> {% trans 'Send' %}</button>
        </div>
        <div id="required-note" >{% trans "* This fields are required" %}</div>
        <p><a id="previousStep">Etape précédente</a></p>
    </div>
</form>



<div id="nonparticipatingcommune" class="modal hide fade" role="dialog" style="z-index: 200000">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>{% trans "Warning" %}!</h3>
    </div>
    <div class="modal-body">
        <p>{% trans "Does not participate to FixMyStreet yet with details"%} <span id="phone"></span></p>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true"> {% trans "Close dialog" %}</button>
    </div>
</div>

{% endblock %}
