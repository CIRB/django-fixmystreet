<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
{% load tags i18n %}
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		{% get_available_languages as LANGUAGES %}
	
		<title>{% trans "Fix My Street Brussels" %} - {% block title %}{% trans "Home" %}{% endblock %}</title>
        {% block script %}
        <script type="text/javascript">
            var SERVICE_GIS_URL = 'http://{{ SERVICE_GIS }}';
            var LANGUAGE_CODE = '{{ LANGUAGE_CODE }}';
            var GEOSERVER_URL = 'http://{{ GEOSERVER }}';
        </script>
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.js"></script>
		<script type="text/javascript" src="{{ STATIC_URL}}js/proj4js/engine/proj4js-compressed.js"></script>
		<script type="text/javascript" src="{{ STATIC_URL}}js/proj4js/defs/EPSG31370.js"></script>
		<script type="text/javascript" src="{{ STATIC_URL}}js/common.js"></script>
        <script type="text/javascript" src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL}}js/jquery/iphone-style-checkboxes.js"></script>
		{% endblock %}
		{% block css %}
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/global.css" />
		<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/layout.css" />
        <link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css"/>
		<link rel="Shortcut Icon" type="image/x-icon" href="{{ STATIC_URL }}images/favicon.ico" />
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL}}js/style.css"/>
        {% endblock %}
		<script>

        /*
        .required.mandatory input, .required.mandatory select {
            border:1px solid red !important;
        }
        form.required-invalid .required-msg {
            color:red;
        }
        
        $(document).delegate("form", "submit", function(evt) {
            var $form = $(this);
            var valid = true;
            
            $('.required input, .required select').each(function(ind,input) {
                var $input = $(input);
                if(!$input.val()) {
                    valid = false;
                    $input.closest('.required').addClass('mandatory');
                } else {
                    $input.closest('.required').removeClass('mandatory');
                }
            });
            
            if(!valid) {
                evt.preventDefault();

                $form.find('.mandatory input, .mandatory select').first().focus();
                $form.find('.required-error-msg').fadeIn();
                $form.addClass('required-invalid');
                
                return false;
            }
        });
        */
		</script>
	</head>

	<body>
		<div id="header">
			<div id="header_content">
                {% if not BACKOFFICE %}
				<a href="{% url home%}"><img id="logo" src="{{ STATIC_URL }}images/logo-{{ LANGUAGE_CODE }}.jpg" alt="{% trans "Fix My Street Brussels" %}"/></a>
                {% else %}
                <a href="{% url home_pro %}"><img id="logo" src="{{ STATIC_URL }}images/logo-{{ LANGUAGE_CODE }}.jpg" alt="{% trans "Fix My Street Brussels" %}"/></a>
                {% endif %}
				<!--<a href="/"><h1 id="banner-title">{% trans "Fix My Street Brussels" %}</h1></a>-->
                <img id="logo-rbc" src="{{ STATIC_URL }}images/logo-rbc-{{ LANGUAGE_CODE }}.jpg" alt="{% trans "Brussels-Capital Region" %}"/>
                {% ifequal ENVIRONMENT "staging" %}
                    <img id="staging-badge" src="{{ STATIC_URL }}images/Staging_badge.png" style="position: absolute; top: 56px; left: 184px;" />
                {% endifequal %}
				<div id="loginButton">
                    {% if request.user.is_authenticated %}
					<button type="button" onclick="window.location.href='{% url auth_logout %}'" style="float: right;margin-top: 44px;">Log out</button>
                    {% else %}
					<button type="button" onclick="window.location.href='{% url login %}?next={% url home_pro %}'" style="float: right;margin-top: 44px;">Sign in</button>
                    {% endif %}
				</div>
				<div id="language">
					<form action="{% url update_last_used_language %}?from={{request.get_full_path}}" method="post">
						<select id="select-language" name="language" onchange="">
							{% for l in LANGUAGES %}
                                {% get_language_info for l.0 as lang %}
                                <option value="{{ lang.code }}"{% if lang.code == LANGUAGE_CODE %} selected="selected"{% endif %}>{{ lang.name_local }}</option>
							{% endfor %}
						</select>
					</form>
				</div>
                <div id="header-name">
                    Connected: {{ request.user.get_full_name }}
                </div>
			</div>
		</div>

		<div id="main_container">
			<div id='body_content'>
                {% if not BACKOFFICE %}
                <div id="menu">
                    {% get_active_menu %}
                    <a class="{% ifequal 'submit' menu %}active{% endifequal %}"   href="{% url home %}">{%         trans "Submit a Report" %}</a>
                    <a class="{% ifequal 'view' menu %}active{% endifequal %}"     href="{% url report_index %}">{% trans "View Reports" %}</a>
                    <a class="{% ifequal 'about' menu %}active{% endifequal %}"    href="{% url about %}">{%        trans "About" %}</a>
                    <a class="{% ifequal 'contact' menu %}active{% endifequal %}"  href="{% url contact %}">{%      trans "Contact Us" %}</a>
                </div>
                {% else %}
                <ul class='leftPane' id="leftMenuPanePro">
                    <li> <a id="allMenuItem" class='category positionable' href="{% url report_list_pro 'all' %}"> Reports <p class="category_number">{{request.user|numberOfReports}}</p></a></a> </li>
                    {% if not request.fmsuser.contractor %}
                    <li><a id='createdMenuItem' class='subcategory positionable' href="{% url report_list_pro 'created' %}"> Created <p class="category_number">{{request.user|numberOfCreatedReports}}</p></a> </li>
                    {% endif %}
                    <li><a id='progressMenuItem' class='subcategory positionable' href="{% url report_list_pro 'in_progress' %}"> Progress <p class="category_number">{{request.user|numberOfInProgressReports}}</p></a></li>
                    <li><a id='closedMenuItem' class='subcategory positionable' href="{% url report_list_pro 'closed' %}"> Closed <p class="category_number">{{request.user|numberOfClosedReports}} </p></a> </li>
                    <li><a id="subscriptionMenuItem" class='subcategory' href="{% url report_subscription_pro %}?subscription=1"> My subscriptions <p class="category_number">{{request.user|numberOfSubscriptions}}</p> </a> <p class="category_number"></p></li>
                    {% if not request.fmsuser.contractor %}
                    <li> <a class='category' href="{% url usersOverview %}?userType=users"> Collaborators <p class="category_number">{{request.user|numberOfUsers}}</p></a></a></li>
                    
                    <li><a class='subcategory' href="{% url usersOverview %}?userType=agent">Agents <p class="category_number">{{request.user|numberOfAgents}}</p></a> </a> </li>
                    <li><a class='subcategory' href="{% url usersOverview %}?userType=contractor">Exec de travaux <p class="category_number">{{request.user|numberOfContractors}}</p></a></a> </li>
                    <li><a class='subcategory' href="{% url usersOverview %}?userType=impetrant"> Imp√©trants <p class="category_number">{{request.user|numberOfImpetrants}}</p></a></a></li>

                    <li><a class='subcategory' href="{% url usersOverview %}?userType=manager"> Gestionnaires <p class="category_number">{{request.user|numberOfManagers}}</p></a></a></li>
                    
                    {% if request.fmsuser.leader %}
                        {% if request.user.id|hasAtLeastAManager %}
                        <li> <a class='category'> Configuration </a></li>
                        <li><a class='subcategory' href="{% url category_gestionnaire_configuration %}"> Gestionnaires </a></li>
                        {% endif %}
                    {% endif %}
                    {% endif %}
                    <li><a id='createMenu' class='category' href=""> Create </a></li> 
                    {% if request.user.id|hasAtLeastAManager %}
                        <li><a id='createReportMenuItem' class='subcategory' href="{% url report_new_pro %}?x=150035.431&y=170906.871#form"> Report </a></li> 
                    {% endif %}
                    {% if request.fmsuser.leader or request.fmsuser.manager %}
                        <li><a id='createUserMenuItem' class='subcategory' href="{% url create_user_pro %}"> Create users </a></li>
                    {% endif %}
                </ul>
                {% endif %}

                {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                    <p{% if message.tags %} class="msg {{ message.tags }}"{% endif %}>{{ message }}</p>
                    {% endfor %}
                </div>
                {% endif %}
				{% block content %}{% endblock %}
			</div>
		</div>

		<div id="footer">
			<div id="footer_content">
				{% block content_third %}{% endblock %}
                <p id="legal_notice">
                    <a id="term_of_use" href="{% url terms_of_use %}">{% trans "Terms of Use" %}</a>
                    Copyright 2011, <a href="http://www.cirb.irisnet.be">CIRB</a> <a href="http://www.cirb.irisnet.be"><img src="{{ STATIC_URL }}images/CIRB-CIBG-inverse.gif"/></a>
                </p>
			</div>
		</div>

		{% block endbody %}{% endblock %}
	</body>
</html>
