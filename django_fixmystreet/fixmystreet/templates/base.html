<!DOCTYPE html>
{% load tags i18n %}
<html>
    <head>
        {% block base %}{% endblock %}

        <!-- <base href="{% if request.is_secure %}https{% else %}http{% endif %}://{{request.get_host}}" target="_blank"/> -->
        <title>{% block title %}{% trans "Home" %}{% endblock %} - {% trans "Fix My Street Brussels" %}</title>
        <!--[if lt IE 9]>
        <script src="{{ STATIC_URL }}lib/html5shiv.js"></script>
        <![endif]-->
        {% block css %}
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}lib/bootstrap/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}lib/bootstrap/css/bootstrap-responsive.min.css" />
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/layout.css" />
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/jquery.qtip.min.css" />

        <link rel="Shortcut Icon" type="image/x-icon" href="{{ STATIC_URL }}favicon.ico" />
        {% endblock %}

        {% block meta %}{% endblock %}
    </head>

    <body>
        <div class="container">
            <header>
                {% if not BACKOFFICE %}
                <a href="{% url 'home' %}">
                    <!--img id="banner" src="{{ STATIC_URL }}images/{{ LANGUAGE_CODE }}/logo_fixmystreet.png" alt="{% trans 'Fix My Street' %}"-->
                    <img id="banner" src="{{ STATIC_URL }}images/logo_fixmystreet.png" alt="{% trans 'Fix My Street' %}">
                </a>
                {% else %}
                <a href="{% url 'home_pro' %}">
                    <!--img id="banner" src="{{ STATIC_URL }}images/{{ LANGUAGE_CODE }}/logo_fixmystreet.png" alt="{% trans 'Fix My Street' %}"-->
                    <img id="banner" src="{{ STATIC_URL }}images/logo_fixmystreet.png" alt="{% trans 'Fix My Street' %}">
                </a>
                {% endif %}

                {% block lng %}
                <section>
                    {% get_available_languages as LANGUAGES %}
                    {% for l in LANGUAGES %}
                    {% get_language_info for l.0 as lang %}
                    <a class="lang{% if lang.code == LANGUAGE_CODE %} selected{% endif %}"
                            href="{% url 'update_current_language' %}?from={{ request.get_full_path }}&language={{ lang.code }}"
                            title="{{ lang.name_local }}">{{ lang.code }}</a>
                    {% endfor %}

                    <div id="login">
                        {% if request.user.is_authenticated %}
                        <a href="{% url 'logout' %}">
                            <i class="icon-login"> </i>{% trans 'Log out' %}
                        </a>
                        <span>{% trans 'Connected' %}: {{ request.user.get_full_name }} ({{ request.fmsuser.get_organisation }})</span>
                        {% else %}
                        <a href="{% url 'login' %}">
                            <i class="icon-login"> </i> {% trans 'Sign in' %}
                        </a>
                        {% endif %}
                    </div>
                </section>
                {% endblock %}

                {% if ENVIRONMENT == "staging" %}
                    <img id="staging-badge" src="{{ STATIC_URL }}images/Staging_badge.png" style="position: absolute; top: 56px; left: 184px;" />
                {% endif %}
                {% if ENVIRONMENT == "staging" or ENVIRONMENT == "dev" or ENVIRONMENT == "local" %}
                    <strong style="position: absolute; bottom: 0; left: 0;">{{ ENVIRONMENT }} {{ APP_VERSION }}</strong>
                {% endif %}

                {% block nav %}
                <nav>
                    {% if not request.user.is_authenticated or not request.fmsuser.is_pro %}
                    <ul>
                        {% get_active_menu %}
                        <li>
                            <a class="{% ifequal 'submit' menu %}active{% endifequal %}"   href="{% url 'home' %}">
                                {% trans "Submit a Report" %}
                            </a>
                        </li>
                        <li>
                            <a class="{% ifequal 'view' menu %}active{% endifequal %}"     href="{% url 'report_index' %}">
                                {% trans "View Reports" %}
                            </a>
                        </li>
                        <li>
                            <a class="{% ifequal 'about' menu %}active{% endifequal %}"    href="{% url 'about' %}">
                                {% trans "About" %}
                            </a>
                        </li>
                    </ul>
                    {% else %}
                    <ul>
                        {% get_active_menu %}
                        <li>
                            <a class="{% ifequal 'submit' menu %}active{% endifequal %}"   href="{% url 'report_prepare_pro' %}">
                                {% trans "Submit a Report" %}
                            </a>
                        <li>
                            <a class="{% ifequal 'view' menu %}active{% endifequal %}"     href="{% url 'report_list_pro' %}">
                                {% trans "View Reports" %}
                            </a>
                        </li>
                        <li class="dropdown">
                            <a class="dropdown-toggle {% ifequal 'users' menu %}active{% endifequal %}" data-toggle="dropdown" href="{% url 'list_users' user_type='users' %}">
                                {% trans "Users" %}
                                <b class="caret"></b>
                            </a>
                             <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                {% if request.fmsuser.leader or request.fmsuser.manager or request.fmsuser.agent %}
                                <li>
                                    <a class="{% ifequal 'list_users' menu %}active{% endifequal %}"     href="{% url 'list_users' user_type='users' %}">
                                        {% trans "Users" %}
                                    </a>
                                </li>
                                {% endif %}
                                {% if request.fmsuser.leader or request.fmsuser.manager or request.fmsuser.agent %}
                                <li>
                                    <a class="{% ifequal 'contractorOverview' menu %}active{% endifequal %}"     href="{% url 'list_contractors' %}">
                                        {% trans "Contractors" %}
                                    </a>
                                </li>
                                {% endif %}
                                {% if request.fmsuser.leader %}
                                    {% if request.user.id|hasAtLeastAManager %}
                                    <li>
                                        <a class="{% ifequal 'users_manager_dispatching' menu %}active{% endifequal %}"  href="{% url 'category_gestionnaire_configuration' %}">
                                            {% trans "Managers dispatching" %}
                                        </a>
                                    </li>
                                    {% endif %}
                                {% endif %}
                                <li>
                                    <a class="{% ifequal 'users_change_password' menu %}active{% endifequal %}"     href="{% url 'password_change' %}">
                                        {% trans "Change your password" %}
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <a class="{% ifequal 'about' menu %}active{% endifequal %}"    href="{% url 'about' %}">
                                {% trans "About" %}
                            </a>
                        </li>
                    </ul>
                    {% endif %}
                </nav>
                {% endblock %}
            </header>

            {% block header-banner %}
            {% endblock %}
            {% block map %}
            {% endblock %}

            <section id="content" class="row">
                {% if messages %}
                <div id="messages">
                    {% for message in messages %}
                    <div class="message modal hide" role="dialog">
                        <div class="modal-body">
                            <p class="lead text-{{ message.tags }}">
                                {% if message.tags == "success" %}
                                    <i class="icon-ok-big"> </i>
                                {% elif message.tags == "warning" %}
                                    <i class="icon-warning-sign"> </i>
                                {% elif message.tags == "error" %}
                                    <i class="icon-nok-big"> </i>
                                {% endif %}
                                <strong>{{ message }}</strong>
                            </p>
                        </div>
                        <div class="modal-footer">
                            <input type="button" class="btn" value="{% trans 'OK'%}" data-dismiss="modal" aria-hidden="true"/>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                {% block content %}{% endblock %}
                <div id="browser_support_popup" class="modal hide fade" role="dialog">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h1>{% trans 'Browser not supported' %}</h1>
                    </div>
                    <div class="modal-body">
                        <h4>{% trans 'Please download one of the supported browsers below before continuing on the website.' %}</h4>
                            <center>
                            <div class="row">
                            <div class="span2"><a target="_blank" href="http://www.mozilla.org/en-US/firefox/new/"><img src="{{STATIC_URL}}images/firefox.png"></a></div>
                            <div class="span2"><a target="_blank" href="http://windows.miﬁosoft.com/en-US/internet-explorer/download-ie"><img src="{{STATIC_URL}}images/internet_explorer.png"></a></div>
                            <div class="span2"><a target="_blank" href="https://www.google.com/intl/en/chrome/browser/"><img src="{{STATIC_URL}}images/chrome.jpeg"></a></div>
                            </div>
                            <div class="row">
                            <div class="span2"><a target="_blank" href="http://www.mozilla.org/en-US/firefox/new/">Firefox (17+)</a></div>
                            <div class="span2"><a target="_blank" href="http://windows.microsoft.com/en-US/internet-explorer/download-ie">Internet Explorer (9+)</a></div>
                            <div class="span2"><a target="_blank" href="https://www.google.com/intl/en/chrome/browser/">Google Chrome (20+)</a></div>
                            </div>
                        </center>

                    </div>
                    <div class="modal-footer">
                        <input type="button" class="btn"  value="{% trans 'Cancel'%}" data-dismiss="modal" aria-hidden="true"/>
                    </div>
                </div>
            </section>

            {% block footer %}
            <footer>
                {% block content_third %}{% endblock %}
                <div style="clear:both;"></div>
                <p>
                    {% trans 'A initiative of Bruxelles Mobilite in collaboration with '%}
                    <a href="{% url 'about' %}#3">{% trans 'Communes and Brussels Partner Institutions'%}</a>
                </p>

                <div class="footer_left">
                    <a href="http://www.cirb.irisnet.be" target="_blank"><img src="{{ STATIC_URL }}images/fms-cirb-logo.png"/>{% trans 'Copyright 2011, CIRB' %}</a>
                </div>

                <div class="footer_right">
                    <a href="http://www.bruxelles.irisnet.be/" target="_blank"><img src="{{ STATIC_URL }}images/region-de-bruxelles-capitale-brussels-hoofdstedelijk-gewest.png"></a>
                </div>

                <div class="footer_center">
                    <a href="{% url 'terms_of_use' %}" target="_blank">{% trans "Terms of Use" %}</a>
                </div>
            </footer>
            {% endblock %}
        </div>
        {% block script %}
        <script type="text/javascript">
            //Test if console.log exists (does not exists on ie8 and <) tips to avoid console.log to block js on those env.
            if (typeof console=='undefined') {
                window.console = new Object();
                window.console.log = function(msg) {/*Does nothing*/};
            }

            var URBIS_URL = '{{ URBIS_URL }}';
            var WMS_SERVICE_URL = '{{ WMS_SERVICE_URL }}';
            var LANGUAGE_CODE = '{{ LANGUAGE_CODE }}';
            if (LANGUAGE_CODE != 'fr' && LANGUAGE_CODE != 'nl') {
                LANGUAGE_CODE = 'fr'
            }
            var GEOSERVER_URL = '//{{ GEOSERVER }}';
            var STATIC_URL = '{{ STATIC_URL }}';
            {% if request.GET.debug %}
            var DEBUG =  true;
            {% else %}
            var DEBUG =  {{ DEBUG|yesno:"true,false" }};
            {% endif %}
            var BACKOFFICE = {{ BACKOFFICE|yesno:"true,false" }};
        </script>
        <script type="text/javascript" src="{{ STATIC_URL }}lib/jquery-1.8.3.min.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}lib/qtip/jquery.qtip.min.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}lib/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/UtilValidator.js"></script>

        {% block mapscript %}
        <script type="text/javascript" src="{{ STATIC_URL }}lib/proj4js/engine/proj4js-compressed.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}lib/proj4js/defs/EPSG31370.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}lib/OpenLayers-2.12/OpenLayers.js"></script>
        <script type="text/javascript" src="{{STATIC_URL}}js/geolocation.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}lib/Popover.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/fixmystreetmap.js"></script>
        {% endblock %}

        <script type="text/javascript" src="{{ STATIC_URL }}js/common.js"></script>

        {% if messages %}
        <script>
            $(function(){
                $('.message').modal();
            });
        </script>
        {% endif %}

        <script type="text/javascript">
            $(function(){
                if (($.browser.msie && parseInt($.browser.version.split(".")[0]) < 9)|| ($.browser.mozilla && parseInt($.browser.version.split(".")[0]) < 10) || $.browser.chrome && parseInt($.browser.version.split(".")[0]) < 20) {
                    $('#browser_support_popup').modal();
                }
                // If on iphone ==> redirect to mobile page
                // if(navigator.platform.indexOf("iPhone") != -1){
                //     window.location="{{request.get_full_path}}../static/iphone_download.html";
                // }
            });
        </script>
        {% ga_script %}
        {% endblock %}
    </body>

</html>
